# Системный мониторинг

## Демон

### Требования
Для сбора метрик на линуксе используются команды:
1.  `df -k` и `df -i` - информация о дисках по каждой файловой системе
1. `iostat -d -k` - загрузка дисков
1. `netstat -lntup` - статистика по сетевым соединениям
1. `tcpdump -nt -i any -ttt -l -v` - top talkers по сети
1. `top -b -n1` - cредняя загрузка системы, cредняя загрузка CPU

Если утилита не найдена по указанному пути, то метрика будет отброшена.

### Конфигурация
Раздел [app] - здесь указываются пути до утилит.
Раздел [metrics] - здесь можно выключать отдельные метрики
Раздел [grpc] - здесь указывается путь до файла логов для GRPC-сервера
Раздел [logg] - здесь устанавливается уровень логгирования приложения

Пример полного конфига
```toml
[app]
topPath = '/usr/bin/top'
iostatPath = '/usr/bin/iostat'
dfPath = '/bin/df'
netStatPath = '/bin/netstat'
tcpDumpPath = '/usr/sbin/tcpdump'
timeoutPath = '/usr/bin/timeout'

[metrics]
cpu = true
disks = true
network = true
connections = true

[grpc]
requestLogFile = './logs/grpc-requests.log'

[logg]
level = 'debug'
```

При запуске демона можно указать порт на котором запустится GRPC-сервер. По умолчанию `:9990`

### Запуск
`./bin/top -config ./configs/app.toml --grpc-addr=:9990`

## Клиент

### Конфигурация
Раздел [logg] - здесь устанавливается уровень логгирования приложения

Полный конфиг 
```toml
[logg]
level = 'debug'
```
При запуске клиента можно указать порт GRPC-сервера, время прогрева и частоту получения метрик.

### Запуск
`./bin/client -config ./configs/client.toml -n 5 -m 15 --grpc-addr=:9990`

## Тестовый сервер

Тестовый сервер можно запустить через прилагающийся docker-compose.yaml командой `make up-dev`. Логи можно смотреть через `make logs-dev`
Сервер будет доступен по порту `:9990`.


# ТЗ на разработку демона, осуществляющего "Системный мониторинг"
[Описание](./TASK.md)